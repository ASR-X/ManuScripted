<script type="text/javascript">
    async function postData(url = '', data = {}) {
    // Default options are marked with *
        const response = await fetch(url, {
            method: 'POST', // *GET, POST, PUT, DELETE, etc.
            headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
            },
            body: JSON.stringify(data) // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }
    async function getData(url = '') {
    // Default options are marked with *
        const response = await fetch(url, {
            method: 'GET', // *GET, POST, PUT, DELETE, etc.
            headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
            },
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }
    function obtainDate() {
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();
        return yyyy + '-' + mm + '-' + dd + "T00:00:00.000Z"
    }
    window.onload=function(){
        var btn = $('div[data-id="new-checkpoint-btn"]');
        var name = $('div[data-id="new-checkpoint-name"]').value;
        var error_msg_div = document.getElementById("error-message-div");
        var error_msg = document.getElementById("error-message");
        
        btn.addEventListener("click", function (e) {
            e.preventDefault()
            btn.disabled = true
            var exists = false
            getData('https://v1.nocodeapi.com/asrx/webflow/arvZVdciEcIdtZsO')
            .then(data => {
                for (let i =0; i < data["count"]; i++) {
                    if(data["items"][i]["name"] == name) {
                        error_msg_div.style.display = "block"
                        error_msg.innerHTML = "Checkpoint already exists"
                        submit.disabled = false
                        console.log("Checkpoint already exists")
                        exists = true
                    }
                }
            })
            if (!exists) {
                const body = {
                    "name" : name,
                    "start-date": obtainDate(),
                    "due-date": "2021-03-25T00:00:00.000Z",
                    "essay" : String(quill.getContents()),
                    "score": "null",
                    "readibilityindex": "null",
                    "essay-length": "null",
                    "avgsentencelength": "null",
                    "avgwordlength" : "null",
                    "nounphrases": "null"
                };
                postData('https://v1.nocodeapi.com/asrx/webflow/arvZVdciEcIdtZsO', body)
                .then(data => {
                    console.log(data);
                    window.location.href = "http://stanfordrejects.com/";
                })
            }
        })
    }
</script>